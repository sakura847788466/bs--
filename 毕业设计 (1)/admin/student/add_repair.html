<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>学生宿舍管理系统</title>
    <link rel="stylesheet" href="../static/css/bootstrap.css">
    <script src="../static/js/jquery-3.3.1.js"></script>
    <script src="../static/js/bootstrap.js"></script>

</head>

<body>
    <div>
        <img src="../static/img/log.png">

    </div>


    <ul class="nav nav-tabs" style="background:orange">
        <li class="tab_item" style="margin-left:100px;"><a onmouseover="this.style.background='white';this.style.color='orange';" onmouseleave="if(this.parentNode.className == 'tab_item'){this.style.background='orange';this.style.color='white';}" href="index.html" style="color:white">首页</a></li>
        <li class="tab_item active"><a style="background:white;color:orange; " onmouseover="this.style.background='white';this.style.color='orange';" onmouseleave="if(this.parentNode.className == 'tab_item'){this.style.background='orange';this.style.color='white';}" href="repair.html"
                style="color:white">网上报修</a></li>
        <li class="tab_item"><a onmouseover="this.style.background='white';this.style.color='orange';" onmouseleave="if(this.parentNode.className == 'tab_item'){this.style.background='orange';this.style.color='white';}" href="cost.html" style="color:white">水电费查看</a></li>
        <li class="tab_item"><a onmouseover="this.style.background='white';this.style.color='orange';" onmouseleave="if(this.parentNode.className == 'tab_item'){this.style.background='orange';this.style.color='white';}" href="modify_password.html" style="color:white">密码修改</a></li>
        <div role="presentation" style="float:right;margin:10px 100px 10px 0"><a style="color:white" href="../user/login.html">注销</a></div>
        <div role="presentation" style="float:right;margin:10px 20px 10px 0"><a style="color:white" href="javascript:;">欢迎您<span class="username"></span></a>
        </div>
    </ul>

    <div style="margin:auto;width:1000px;height:100%">

        <div class="panel panel-warning" style="background:	#F2F2F2;margin-top:30px;">
            <div class="panel-heading">网上报修</div>
            <div class="panel-body" style="margin-left:50px;color:orange">
                <form action="#" method="post">
                    <input type="text" {% if status==1 %} value="{{ dormitory.before_name }}" {% else %} value="{{ dormitory.name }}" {% endif %} name="before_name" style="display:none">
                    <div class="form-group">
                        <label style="">报修寝室：<span class= "bedname"></span></label>
                    </div>
                    <div class="form-group">
                        <label>报修类型：</label>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span id="type_show"></span><span style="color:orange" class="caret"></span>
                        </button>
                            <input type="text" id="type" name="type" value="" style="display:none">
                            <ul class="dropdown-menu">
                                <li><a href="javascript:;" onclick="document.getElementById('type_show').innerHTML=this.innerHTML;document.getElementById('type').value='用水类'; choice('water')">用水类</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('type_show').innerHTML=this.innerHTML;document.getElementById('type').value='电器类'; choice('electric')">电器类</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('type_show').innerHTML=this.innerHTML;document.getElementById('type').value='门窗类'; choice('door')">门窗类</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('type_show').innerHTML=this.innerHTML;document.getElementById('type').value='家具类'; choice('furniture')">家具类</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>报修设备：</label>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                            <span id="name_show"></span><span style="color:orange" class="caret"></span>
                        </button>
                            <input type="text" id="name" name="name" value="" style="display:none">
                            <ul id="water" class="dropdown-menu  two" style="display:block" >
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='卫生间水龙头';">卫生间水龙头</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='洗手台水龙头';">洗手台水龙头</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='冲凉房水龙头';">冲凉房水龙头</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='阳台水龙头';">阳台水龙头</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='其他请备注';">其他请备注</a>
                                </li>

                            </ul>
                            <ul id="electric" class="dropdown-menu" style="display:none">
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='风扇';">风扇</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='空调';">空调</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='卫生间电灯';">卫生间电灯</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='冲凉房电灯';">冲凉房电灯</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='阳台电灯';">阳台电灯</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='室内电灯';">室内电灯</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='直饮水机';">直饮水机</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='其他请备注';">其他请备注</a>
                                </li>


                            </ul>
                            <ul id="door" class="dropdown-menu" style="display:none">
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='窗';">窗</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='外门';">外门</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='内门';">内门</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='卫生间门';">卫生间门</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='冲凉房门';">冲凉房门</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='其他请备注';">其他请备注</a>
                                </li>

                            </ul>
                            <ul id="furniture" class="dropdown-menu" style="display:none">
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='椅子';">椅子</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='桌子';">桌子</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='床';">床</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='柜子';">柜子</a>
                                </li>
                                <li><a href="javascript:;" onclick="document.getElementById('name_show').innerHTML=this.innerHTML;document.getElementById('name').value='其他请备注';">其他请备注</a>
                                </li>


                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>联系方式</label>
                        <input type="number" maxlength="11" class="form-control" name="contact" style="width:300px;">
                    </div>
                     <div class="form-group">
                        <label>邮箱地址</label>
                        <input   class="form-control email" name="contact" style="width:300px;" >
                    </div>
                    <div class="form-group">
                        <label>备注信息</label>
                        <textarea maxlength="20" id="shurukuang"placeholder="不能超过20个字数" class="form-control" name="content" style="width:400px;"></textarea>
                    </div>
                    <div class="form-group">
                        <input type="" style="background:orange;border:0" class="btn btn-primary" value="立即报修" onclick="tijiao()">
                    </div>
                </form>
            </div>
        </div>
        <script>
        xuanran();
            function choice(type) {

               

                document.getElementById(type).style.display = "";
            }
  

     function  xuanran(){
         let storage =window.localStorage;
                let getusername = storage.getItem('bedname');
                let getusernamee = storage.getItem('username');
                $(".username").html(getusernamee)
                $(".bedname").html(getusername)
     }
//提交报修信息
     function  tijiao(){
        var bedname = $(".bedname").html();
         var type =  $("#type_show").html();
         var typeTwo =  $("#name_show").html();
         var phone = $(".form-control").val();
         var beizhu = $("#shurukuang").val()
         var myDate = new Date();
         var time =  myDate.toLocaleString( );
          console.log( myDate.toLocaleString( ));   

 let url ='http://127.0.0.1:3000/goods/addRepair'
        let  data ={
             num:bedname,
            type:type,
            thing:typeTwo,
            phone:phone,
            time:time,
            stutas:"未处理",
            beizhu:beizhu,
            jianyi:"等待确认验收"
          }
          sendEmail();
        $.post(url,data,function(res){
            console.log(res)
            if(res=="添加插入ok"){
                alert("保修成功")
            window.location.href="http://127.0.0.1:3000/student/repair.html"

            }
            else{

            }
        })

         console.log(bedname+type+typeTwo+phone+beizhu)


     }

     function sendEmail(){
        var mail = $(".email").val();
         var bedname = $(".bedname").html();
         var type =  $("#type_show").html();
         var typeTwo =  $("#name_show").html();
         var phone = $(".form-control").val();
         var beizhu = $("#shurukuang").val()
         var myDate = new Date();
         var time =  myDate.toLocaleString( );
          // console.log( myDate.toLocaleString( ));   
        console.log(mail)
        let url ='http://127.0.0.1:3000/goods/sendEmail';
        let  data ={
             mail:mail,
            num:bedname,
            type:type,
            thing:typeTwo,
            phone:phone,
            time:time,
            beizhu:beizhu
          }
        $.post(url,data,function(res){
            console.log(res)
        })


     }
        </script>


        <!-- <script src="../static/js/student.js"></script> -->
</body>

</html>